# 结构

结构是一个或多个变量的集合，这些变量可能为不同的类型，为了处理的方便而将这些变量组织在一个名字之下。

结构可以拷贝、赋值、传递给函数，函数也可以返回结构类型的返回值。在 ANSI 标准中，自动结构和数组现在也可以进行初始化。

## 结构的基础知识

```c
struct point {
    int x;
    int y;
}
```

关键字 `struct` 引入结构声明。结构声明由花括号内的一系列声明组成。关键字 `struct` 后面的名字是可选的，称为结构标记（上面中的 point）。结构中定义的变量称为成员。

`struct` 声明定义了一种数据类型。在标志结构成员表结束的右花括号之后可以跟一个变量表，这与其他基本类型的变量声明是相同的。

```c
struct {...} x, y, z;
```

如果结构声明的后面不带变量表，则不需要为它分配存储空间，它仅仅描述了一个结构的模板和轮廓。但是，如果结构声明中带有标记，那么在以后定义结构实例时便可以使用该标记定义。例如，对于上面给出的结构声明 point

```c
// 定义了一个 struct point 类型的变量 pt
struct point pt;
```

结构的初始化可以在定义的后面使用初值表进行。初值表中同每个成员对应的初值必须是常量表达式，例如：

```c
struct point maxpt = {320, 200};
```

可以通过下列形式引用某个特定结构中的成员：

```c
结构名.成员
```

结构可以嵌套，例如：

```c
struct rect {
    struct point pt1;
    struct point pt2;
}

// 声明 screen 变量
struct rect screen;

// 引用 screen 的成员 pt1 的 x 坐标
screen.pt1.x
```

## 结构与函数

结构的合法操作只有几种：作为一个整体复制和赋值，通过 `&` 运算符取地址，访问其成员。

其中复制和赋值包括向函数传递参数以及从函数返回值。

结构之间不可以进行比较。

至少可以通过 3 中可能的方法传递结构：

- 分别传递各个结构成员
- 传递整个结构
- 传递指向结构的指针

结构类型的参数和其他类型参数一样，都是通过值传递的。如果传递给函数的结构很大，使用指针方式的效率通常比复制整个结构的效率要高。结构指针类似于普通变量指针：

```c
// 定义 pp 为一个指向 struct point 类型对象的指针
struct point *pp;

*pp         // 为该结构
(*pp).x     // 是结构成员，圆括号是必需的，因为结构成员运算符 “.” 的优先级比 “*” 的优先级高
```

结构指针的使用频度非常高，为了使用方便，C语言提供了另一种简写方式。假定 p 是一个指向结构的指针，可以用

```c
// 这种形式应用相应的结构成员
p -> 结构成员

// 等价于
(*p).结构成员
```

## 结构数组

```c
// 声明一个结构类型 key，并定义了该类型的结构数组 keytab，同时为其分配存储空间
struct key {
    char *word;
    int count
} keytab[NKEYS];

// 可以等价的写成下列形式
struct key {
    char *word;
    int count;
};
struct key keytab[NKEYS];
```

这种结构的初始化方法同前面所述的初始化方法类似，在定义的后面通过一个花括号括起来的初始值表进行初始化，如：

```c
struct key {
    char *word;
    int count
} keytab[] = {
    "auto", 0,
    "break": 0,
    "case", 0
};

// 与结构成员相对应，初值也要按照成对的方式列出。更精确的做法是，将每一行（即每个结构）的初值都括在花括号内
struct key {
    char *word;
    int count
} keytab[] = {
    {"auto", 0},
    {"break": 0},
    {"case", 0}
};
```

C语言提供了一个编译时(compile-time)一元运算符 `sizeof`，它可用来计算任一对象的长度，表达式：

```c
sizeof 对象
// 以及
sizeof (类型名)
```

将返回一个整型值（无符号整型值，其类型为 `size_t`，该类型在头文件 `<stddef.h>` 中定义），它等于指定对象或类型占用的存储空间字节数。
